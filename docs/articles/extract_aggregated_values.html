<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extract aggregated Values (time and space) of the rainfall data • rainfallR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extract aggregated Values (time and space) of the rainfall data">
<meta property="og:description" content="rainfallR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rainfallR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ExamplePolygonExtraction.html">Example Extraction for one polygon</a>
    </li>
    <li>
      <a href="../articles/diff_data.html">Use data that is not IFFI data</a>
    </li>
    <li>
      <a href="../articles/extract_aggregated_values.html">Extract aggregated Values (time and space) of the rainfall data</a>
    </li>
    <li>
      <a href="../articles/extract_rainfall_slope_unit.html"> Extract rainfall data for slopeunit-polygons</a>
    </li>
    <li>
      <a href="../articles/points.html">Extract the rainfall for points</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="extract_aggregated_values_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extract aggregated Values (time and space) of the rainfall data</h1>
            
      
      
      <div class="hidden name"><code>extract_aggregated_values.Rmd</code></div>

    </div>

    
    
<ul>
<li><p>A common tasks is the calculation of the mean rainfall pixel value in a certain time-period.</p></li>
<li><p>In this process you can aggregate for different time-periods (like months or years) and different spatial extents (slope-units, pixel-based…)</p></li>
<li>
<p>Questions could be like:</p>
<ol style="list-style-type: decimal">
<li><p>What is the mean cumulative pixel-value for all pixels in the province of South Tyrol between 1980 and 2018 (<strong>pixel based</strong>)</p></li>
<li><p>What is the maximum monthly value for all months between 2015 and 2018 (<strong>pixel based</strong>)</p></li>
<li><p>What is the mean annual Slope-unit rainfall for all slope units in the province of South Tyrol (<strong>polygon-based</strong>)</p></li>
</ol>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">rainfallR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/stars/">stars</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: abind</span>
<span class="co">#&gt; Loading required package: sf</span>
<span class="co">#&gt; Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 7.0.0</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></code></pre></div>
<ul>
<li><p>So lets try to answer the very basic question (Question number 1 above) and get the cumulative annual pixel value for each pixel for the year 2015 and 2016</p></li>
<li><p>The rastes are stored in NetCDF which each hold the data for one month. In order to get the mean for each pixel in one year we need to sum up the values for the ~ 365 days and devide them by 365. The addition is the part that the function <code>aggregate_rainfall</code> can make.</p></li>
<li><p>In the time dimension we want to sum up all values in one month for each pixel. So we set the <code>daily_fun</code> to <code>sum</code></p></li>
<li><p>We also want to sum up all the months, so we set <code>monthly_fun</code> also to <code>sum</code></p></li>
<li><p>And call the function like</p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>os <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">Sys.info</span>()[<span class="st">"sysname"</span>] <span class="sc">==</span> <span class="st">"Windows"</span>, <span class="st">"w"</span>, <span class="st">"l"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(os <span class="sc">==</span> <span class="st">"l"</span>){</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  path_ncdf <span class="ot">=</span> <span class="st">"/mnt/CEPH_PROJECTS/Proslide/PREC_GRIDS_updated/"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span>{</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  path_ncdf <span class="ot">=</span> <span class="st">"</span><span class="sc">\\\\</span><span class="st">projectdata.eurac.edu/projects/Proslide/PREC_GRIDS_updated/"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>yearly_sums <span class="ot">=</span> <span class="fu">aggregate_rainfall</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">path_ncdf =</span> <span class="st">"/mnt/CEPH_PROJECTS/Proslide/PREC_GRIDS_updated/"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">polygon =</span> <span class="cn">NULL</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">years =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2016</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"year"</span>, <span class="co"># we only want the computed values for each year</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">daily_fun =</span> <span class="st">"sum"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">monthly_fun =</span> <span class="st">"sum"</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; - - - - - - - - - - - - - - - - - - - - 2015</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">1</span> <span class="dv">2015</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">2</span> <span class="dv">2015</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">3</span> <span class="dv">2015</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">4</span> <span class="dv">2015</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">5</span> <span class="dv">2015</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">6</span> <span class="dv">2015</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">7</span> <span class="dv">2015</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">8</span> <span class="dv">2015</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">9</span> <span class="dv">2015</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">10</span> <span class="dv">2015</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">11</span> <span class="dv">2015</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">12</span> <span class="dv">2015</span><span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="sc">-</span> <span class="dv">2016</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">1</span> <span class="dv">2016</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">2</span> <span class="dv">2016</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">3</span> <span class="dv">2016</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">4</span> <span class="dv">2016</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">5</span> <span class="dv">2016</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">6</span> <span class="dv">2016</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">7</span> <span class="dv">2016</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">8</span> <span class="dv">2016</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">9</span> <span class="dv">2016</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">10</span> <span class="dv">2016</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">11</span> <span class="dv">2016</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a> Reading<span class="sc">:</span>  <span class="dv">12</span> <span class="dv">2016</span></span></code></pre></div>
<ul>
<li><p>what we get back is one stars object with a dimension called <code>years</code></p></li>
<li><p>We can plot the results and it looks like this:</p></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">yearly_sums</span><span class="op">)</span></code></pre></div>
<p><img src="extract_aggregated_values_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<ul>
<li>We can now also calculate the mean of the two years:</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mean_2k15_2k16</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_apply.html">st_apply</a></span><span class="op">(</span><span class="va">yearly_sums</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, <span class="va">mean</span><span class="op">)</span></code></pre></div>
<ul>
<li>and plot it</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">mean_2k15_2k16</span>, main<span class="op">=</span><span class="st">"Mean rainfall in the years 2015 and 2016"</span><span class="op">)</span>
<span class="co"># get the shape for South Tyrol</span>
<span class="va">st</span> <span class="op">=</span> <span class="fu">iffitoR</span><span class="fu">::</span><span class="fu">get_shape_southtyrol</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://r-spatial.github.io/stars/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">st</span><span class="op">[</span><span class="fl">0</span><span class="op">]</span>, add<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="st">"red"</span>, lty<span class="op">=</span><span class="fl">19</span><span class="op">)</span></code></pre></div>
<p><img src="extract_aggregated_values_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
